option(RESKIA_BUILD_TESTS "Build test_c_skia target" OFF)
if(RESKIA_BUILD_TESTS)
    enable_testing()
    add_executable(test_c_skia test/test.cpp )
    target_include_directories(test_c_skia PRIVATE ${RESKIA_PUBLIC_INCLUDE_DIRS})
    if(APPLE)
        find_library(CORE_FOUNDATION CoreFoundation)
        find_library(CORE_TEXT CoreText)
        target_link_libraries(test_c_skia reskia "-framework CoreFoundation" "-framework CoreText" ${CORE_FOUNDATION} ${CORE_TEXT} fontconfig)
    elseif (WIN32)
        target_link_libraries(test_c_skia reskia)
    endif ()
    add_test(NAME c_skia_test COMMAND test_c_skia)

    add_executable(test_codec_smoke test/test_codec_smoke.cpp)
    target_include_directories(test_codec_smoke PRIVATE ${RESKIA_PUBLIC_INCLUDE_DIRS})
    if(RESKIA_DEP_LINK_DIRS)
        target_link_directories(test_codec_smoke PRIVATE ${RESKIA_DEP_LINK_DIRS})
    endif()
    target_link_libraries(test_codec_smoke reskia ${RESKIA_DEP_LIBS})
    if(RESKIA_ENABLE_AVIF)
        target_compile_definitions(test_codec_smoke PRIVATE RESKIA_TEST_ENABLE_AVIF=1)
    endif()
    if(RESKIA_ENABLE_JPEGXL)
        target_compile_definitions(test_codec_smoke PRIVATE RESKIA_TEST_ENABLE_JPEGXL=1)
    endif()
    if(RESKIA_ENABLE_GIF)
        target_compile_definitions(test_codec_smoke PRIVATE RESKIA_TEST_ENABLE_GIF=1)
    endif()
    if(RESKIA_ENABLE_RAW)
        target_compile_definitions(test_codec_smoke PRIVATE RESKIA_TEST_ENABLE_RAW=1)
    endif()
    if(RESKIA_ENABLE_JPEG_ENCODER)
        target_compile_definitions(test_codec_smoke PRIVATE RESKIA_TEST_ENABLE_JPEG_ENCODER=1)
    endif()
    if(RESKIA_ENABLE_WEBP_ENCODER)
        target_compile_definitions(test_codec_smoke PRIVATE RESKIA_TEST_ENABLE_WEBP_ENCODER=1)
    endif()
    if(APPLE)
        target_compile_definitions(test_codec_smoke PRIVATE RESKIA_TEST_ENABLE_OPEN_TYPE_SVG=1)
    endif()
    add_test(NAME c_skia_codec_smoke COMMAND test_codec_smoke)

    if(APPLE AND TARGET svg AND TARGET skshaper AND TARGET skunicode)
        add_executable(test_shaping_smoke test/test_shaping_smoke.cpp)
        target_include_directories(test_shaping_smoke PRIVATE
                ${RESKIA_PUBLIC_INCLUDE_DIRS}
                "${RESKIA_ROOT_DIR}/svg"
        )
        if(RESKIA_DEP_LINK_DIRS)
            target_link_directories(test_shaping_smoke PRIVATE ${RESKIA_DEP_LINK_DIRS})
        endif()
        target_link_libraries(test_shaping_smoke reskia ${RESKIA_DEP_LIBS})
        add_test(NAME c_skia_shaping_smoke COMMAND test_shaping_smoke)
    endif()

    if(RESKIA_ENABLE_PDF)
        add_executable(test_pdf_smoke test/test_pdf_smoke.cpp)
        target_include_directories(test_pdf_smoke PRIVATE ${RESKIA_PUBLIC_INCLUDE_DIRS})
        if(RESKIA_DEP_LINK_DIRS)
            target_link_directories(test_pdf_smoke PRIVATE ${RESKIA_DEP_LINK_DIRS})
        endif()
        target_link_libraries(test_pdf_smoke reskia ${RESKIA_DEP_LIBS})
        add_test(NAME c_skia_pdf_smoke COMMAND test_pdf_smoke)
    endif()

    if(RESKIA_ENABLE_SKOTTIE)
        add_executable(test_skottie_smoke test/test_skottie_smoke.cpp)
        target_include_directories(test_skottie_smoke PRIVATE ${RESKIA_PUBLIC_INCLUDE_DIRS})
        if(RESKIA_DEP_LINK_DIRS)
            target_link_directories(test_skottie_smoke PRIVATE ${RESKIA_DEP_LINK_DIRS})
        endif()
        target_link_libraries(test_skottie_smoke reskia ${RESKIA_DEP_LIBS})
        add_test(NAME c_skia_skottie_smoke COMMAND test_skottie_smoke)
    endif()

    if(RESKIA_ENABLE_SKSG)
        add_executable(test_sksg_smoke test/test_sksg_smoke.cpp)
        target_include_directories(test_sksg_smoke PRIVATE ${RESKIA_PUBLIC_INCLUDE_DIRS})
        if(RESKIA_DEP_LINK_DIRS)
            target_link_directories(test_sksg_smoke PRIVATE ${RESKIA_DEP_LINK_DIRS})
        endif()
        target_link_libraries(test_sksg_smoke reskia ${RESKIA_DEP_LIBS})
        add_test(NAME c_skia_sksg_smoke COMMAND test_sksg_smoke)

        add_executable(test_sksg_capi_smoke test/test_sksg_capi_smoke.cpp)
        target_include_directories(test_sksg_capi_smoke PRIVATE ${RESKIA_PUBLIC_INCLUDE_DIRS})
        if(RESKIA_DEP_LINK_DIRS)
            target_link_directories(test_sksg_capi_smoke PRIVATE ${RESKIA_DEP_LINK_DIRS})
        endif()
        target_link_libraries(test_sksg_capi_smoke reskia ${RESKIA_DEP_LIBS})
        add_test(NAME c_skia_sksg_capi_smoke COMMAND test_sksg_capi_smoke)
    endif()

    if(RESKIA_ENABLE_SKPARAGRAPH AND TARGET skshaper AND TARGET skunicode)
        add_executable(test_skparagraph_smoke test/test_skparagraph_smoke.cpp)
        target_include_directories(test_skparagraph_smoke PRIVATE
                ${RESKIA_PUBLIC_INCLUDE_DIRS}
                "${RESKIA_ROOT_DIR}/svg"
        )
        if(RESKIA_DEP_LINK_DIRS)
            target_link_directories(test_skparagraph_smoke PRIVATE ${RESKIA_DEP_LINK_DIRS})
        endif()
        target_link_libraries(test_skparagraph_smoke reskia ${RESKIA_DEP_LIBS})
        add_test(NAME c_skia_skparagraph_smoke COMMAND test_skparagraph_smoke)
    endif()

    if(APPLE AND RESKIA_ENABLE_GPU_GANESH AND RESKIA_ENABLE_GPU_METAL)
        add_executable(test_gpu_surface_capi_smoke test/test_gpu_surface_capi_smoke.mm)
        target_include_directories(test_gpu_surface_capi_smoke PRIVATE
                ${RESKIA_PUBLIC_INCLUDE_DIRS}
        )
        if(RESKIA_DEP_LINK_DIRS)
            target_link_directories(test_gpu_surface_capi_smoke PRIVATE ${RESKIA_DEP_LINK_DIRS})
        endif()
        target_link_libraries(test_gpu_surface_capi_smoke reskia ${RESKIA_DEP_LIBS} "-framework Metal")
        add_test(NAME c_skia_gpu_surface_capi_smoke COMMAND test_gpu_surface_capi_smoke)
    endif()

    if(APPLE AND RESKIA_ENABLE_GPU_METAL AND (RESKIA_ENABLE_GPU_GANESH OR RESKIA_ENABLE_GPU_GRAPHITE))
        add_executable(test_gpu_context_capi_smoke test/test_gpu_context_capi_smoke.mm)
        target_include_directories(test_gpu_context_capi_smoke PRIVATE
                ${RESKIA_PUBLIC_INCLUDE_DIRS}
        )
        if(RESKIA_DEP_LINK_DIRS)
            target_link_directories(test_gpu_context_capi_smoke PRIVATE ${RESKIA_DEP_LINK_DIRS})
        endif()
        target_compile_definitions(test_gpu_context_capi_smoke PRIVATE
                RESKIA_TEST_GPU_GANESH=$<BOOL:${RESKIA_ENABLE_GPU_GANESH}>
                RESKIA_TEST_GPU_GRAPHITE=$<BOOL:${RESKIA_ENABLE_GPU_GRAPHITE}>
        )
        target_link_libraries(test_gpu_context_capi_smoke reskia ${RESKIA_DEP_LIBS} "-framework Metal")
        add_test(NAME c_skia_gpu_context_capi_smoke COMMAND test_gpu_context_capi_smoke)
    endif()
endif()
